<html>

<head>
    <script type="text/javascript" src="lib/repl.js"></script>
</head>

<body>
    <h1>Web:Bit v2 MicroPython</h1>
    <button id="upload">upload</button>
    <div id='msg'>wait to connect...</div>
    <textarea id="ctx" rows="10" style="width:480px"></textarea><br>
    <textarea id="resp" rows="10" style="width:480px"></textarea>
    <script>
        var repl = new REPL();
        fetch('./webbit.py').then(function (response) {
            return response.text();
        }).then(async function (text) {
            ctx.value = text;
            msg.innerHTML = '';
        });

        upload.addEventListener('click', async () => {
            upload.disabled = true;
            await repl.usbConnect();
            msg.innerHTML = 'uploading...';
            var writeLen = await repl.uploadFile(ctx.value);
            msg.innerHTML = 'upload main.py ,' + writeLen + " Bytes";
            upload.disabled = false;
        })
    </script>
</body>

</html>